<!DOCTYPE html>
<html lang="ml">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lottery Pro Max - Voice Edition</title>
<style>
    :root {
        --bg: #f4f7f6; --card-bg: #ffffff; --text: #333;
        --primary: #2196F3; --secondary: #ffc107;
        --success: #4CAF50; --danger: #f44336; --border: #ddd;
    }
    body.dark-mode {
        --bg: #121212; --card-bg: #1e1e1e; --text: #e0e0e0; --border: #333;
    }
    body { margin: 0; font-family: sans-serif; background: var(--bg); color: var(--text); transition: 0.3s; }
    .screen { min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 10px; box-sizing: border-box; }
    .card { width: 100%; max-width: 450px; background: var(--card-bg); border-radius: 15px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); box-sizing: border-box; }
    .header-tools { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .theme-toggle { cursor: pointer; background: none; border: 1px solid var(--border); padding: 5px 10px; border-radius: 20px; color: var(--text); font-size: 11px; }
    .tabs-container { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 10px; border-bottom: 1px solid var(--border); }
    .tab { padding: 8px 15px; background: #eee; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; white-space: nowrap; color: #555; }
    .tab.active { background: var(--primary); color: white; }
    .add-tab { padding: 8px 15px; background: var(--success); color: white; border-radius: 20px; cursor: pointer; font-weight: bold; }
    input, button { width: 100%; padding: 12px; margin: 5px 0; font-size: 16px; border: 1px solid var(--border); border-radius: 8px; box-sizing: border-box; background: var(--card-bg); color: var(--text); }
    .row { display: flex; gap: 8px; }
    .row > * { flex: 1; }
    button { font-weight: bold; cursor: pointer; border: none; }
    .wa-btn { background: #25D366; color: white; }
    .voice-btn { background: #E91E63; color: white; transition: 0.3s; }
    .add-btn { background: var(--primary); color: white; }
    .box-btn { background: var(--secondary); color: #000; }
    .reset-btn { background: #757575; color: white; }
    .save-btn { background: var(--success); color: white; }
    .list { margin-top: 10px; max-height: 250px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; }
    .item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid var(--border); }
    .del-btn { background: none; color: var(--danger); width: auto; padding: 5px; font-size: 18px; }
    .total-section { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding: 10px; background: var(--primary); color: white; border-radius: 8px; font-weight: bold; font-size: 18px; }
    .hidden { display: none; }
    .status-voice { text-align: center; color: #E91E63; font-weight: bold; font-size: 14px; margin: 5px 0; display: none; }
</style>
</head>
<body>

<audio id="beepSound" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

<div class="screen" id="mainPage">
    <div class="card">
        <div class="header-tools">
            <h3 style="margin:0; color:var(--primary);">Lottery Voice Pro</h3>
            <button class="theme-toggle" onclick="toggleTheme()">DARK MODE</button>
        </div>
        <div class="tabs-container" id="tabsList"></div>
        <input id="customer" placeholder="Customer Name" oninput="updateTabName()">
        
        <div class="row">
            <button class="voice-btn" id="voiceBtn" onclick="startVoice()">üé§ ‡¥µ‡µã‡¥Ø‡µç‚Äå‡¥∏‡µç</button>
            <button class="wa-btn" onclick="share('live')">WHATSAPP</button>
        </div>
        <div id="voiceStatus" class="status-voice">‡¥∂‡µç‡¥∞‡¥¶‡µç‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ... (‡¥∏‡¥Ç‡¥∏‡¥æ‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï)</div>

        <div class="row">
            <button class="reset-btn" onclick="resetAll()">RESET</button>
            <button class="save-btn" onclick="saveDay()">SAVE</button>
        </div>
        
        <div id="normalInput">
            <div class="row">
                <input id="num" placeholder="Number" maxlength="3" type="tel">
                <input id="count" placeholder="Count" type="tel">
            </div>
        </div>

        <div class="row">
            <button class="add-btn" onclick="addEntry()">ADD</button>
            <button class="box-btn" onclick="boxEntry()">BOX</button>
        </div>

        <div class="list" id="liveList"></div>
        <div class="total-section"><span>GT</span><span id="liveTotal">0</span></div>
        <button style="margin-top:15px; background:#607D8B; color:white;" onclick="openSaved()">SAVED HISTORY</button>
    </div>
</div>

<div class="screen hidden" id="savedPage">
    <div class="card">
        <h2>Saved History</h2>
        <div class="row">
            <button style="background:#673AB7; color:white;" onclick="renderSaved(true)">MERGE & SORT</button>
            <button class="wa-btn" onclick="share('saved')">WA SHARE</button>
        </div>
        <div class="list" id="savedList"></div>
        <div class="total-section" style="background:#555;"><span>GT</span><span id="savedTotal">0</span></div>
        <button style="background:#757575; color:white; margin-top:10px;" onclick="backToMain()">BACK</button>
    </div>
</div>

<script>
    let customers = JSON.parse(localStorage.getItem("lottery_customers")) || [{name: "", temp: []}];
    let activeIndex = 0;
    let permanent = JSON.parse(localStorage.getItem("perm_list")) || [];
    const beep = document.getElementById("beepSound");

    // Voice Recognition Setup
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'ml-IN';
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onstart = () => {
            document.getElementById('voiceStatus').style.display = 'block';
            document.getElementById('voiceBtn').style.background = '#f44336';
            document.getElementById('voiceBtn').innerText = 'üõë ‡¥±‡µÜ‡¥ï‡µç‡¥ï‡µã‡µº‡¥°‡¥ø‡¥Ç‡¥ó‡µç..';
        };

        recognition.onend = () => {
            document.getElementById('voiceStatus').style.display = 'none';
            document.getElementById('voiceBtn').style.background = '#E91E63';
            document.getElementById('voiceBtn').innerText = 'üé§ ‡¥µ‡µã‡¥Ø‡µç‚Äå‡¥∏‡µç';
        };

        recognition.onresult = (event) => {
            const result = event.results[0][0].transcript;
            processVoiceData(result);
        };

        recognition.onerror = (event) => {
            if(event.error === 'not-allowed') {
                alert("‡¥Æ‡µà‡¥ï‡µç‡¥∞‡µã‡¥´‡µã‡µ∫ ‡¥™‡µÜ‡µº‡¥Æ‡¥ø‡¥∑‡µª ‡¥¨‡µç‡¥≤‡µã‡¥ï‡µç‡¥ï‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡¥æ‡¥£‡µç. ‡¥¨‡µç‡¥∞‡µó‡¥∏‡µº ‡¥∏‡µÜ‡¥±‡µç‡¥±‡¥ø‡¥Ç‡¥ó‡µç‡¥∏‡¥ø‡µΩ ‡¥á‡¥§‡µç ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡µÅ‡¥ï.");
            }
        };
    }

    function startVoice() {
        if (!recognition) return alert("‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø Chrome ‡¥¨‡µç‡¥∞‡µó‡¥∏‡µº ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.");
        if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
            alert("‡¥µ‡µã‡¥Ø‡µç‚Äå‡¥∏‡µç ‡¥´‡µÄ‡¥ö‡µç‡¥ö‡µº ‡¥∏‡µÅ‡¥∞‡¥ï‡µç‡¥∑‡¥ø‡¥§‡¥Æ‡¥æ‡¥Ø (HTTPS) ‡¥µ‡µÜ‡¥¨‡µç‚Äå‡¥∏‡µà‡¥±‡µç‡¥±‡µÅ‡¥ï‡¥≥‡¥ø‡µΩ ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Æ‡µá ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥ø‡¥ï‡µç‡¥ï‡µÇ. ‡¥á‡¥§‡µç GitHub-‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥ø‡¥Ø‡¥æ‡µΩ ‡¥∂‡¥∞‡¥ø‡¥Ø‡¥æ‡¥ï‡µÅ‡¥Ç.");
            return;
        }
        recognition.start();
    }

    function processVoiceData(text) {
        // ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç ‡¥∏‡¥Ç‡¥∏‡¥æ‡¥∞‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥®‡¥Æ‡µç‡¥™‡¥±‡µÅ‡¥ï‡µæ ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡µÅ‡¥®‡µç‡¥®‡µÅ
        let nums = text.match(/\d+/g); 
        if (nums && nums.length >= 2) {
            let n = nums[0].padStart(3, '0');
            let c = nums[1];
            addManual(n, c);
        } else {
            alert("‡¥Æ‡¥®‡¥∏‡µç‡¥∏‡¥ø‡¥≤‡¥æ‡¥Ø‡¥ø‡¥≤‡µç‡¥≤: '" + text + "'. ‡¥®‡¥Æ‡µç‡¥™‡¥±‡µÅ‡¥Ç ‡¥ï‡µó‡¥£‡µç‡¥ü‡µÅ‡¥Ç ‡¥™‡¥±‡¥Ø‡µÅ‡¥ï.");
        }
    }

    function addManual(n, c) {
        if (n.length > 3) n = n.slice(-3);
        customers[activeIndex].temp.push({n: n, c: Number(c)});
        beep.play();
        renderLive();
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem("theme", document.body.classList.contains('dark-mode') ? "dark" : "light");
    }
    if(localStorage.getItem("theme") === "dark") document.body.classList.add('dark-mode');

    function initTabs() {
        let html = "";
        customers.forEach((c, i) => {
            html += `<div class="tab ${i === activeIndex ? 'active' : ''}" onclick="switchTab(${i})">${c.name || 'New Cust'}</div>`;
        });
        html += `<div class="add-tab" onclick="addNewCustomer()">+ Add</div>`;
        document.getElementById("tabsList").innerHTML = html;
        document.getElementById("customer").value = customers[activeIndex].name;
        renderLive();
    }

    function switchTab(i) { activeIndex = i; initTabs(); }
    function addNewCustomer() { customers.push({name: "", temp: []}); activeIndex = customers.length - 1; initTabs(); }
    function updateTabName() { customers[activeIndex].name = document.getElementById("customer").value; initTabs(); saveAll(); }
    function saveAll() { localStorage.setItem("lottery_customers", JSON.stringify(customers)); }

    function renderLive() {
        let html = "", total = 0;
        let list = customers[activeIndex].temp;
        [...list].reverse().forEach((item, i) => {
            let idx = list.length - 1 - i;
            html += `<div class="item"><span>${item.n} - (<b>${item.c}</b>)</span><button class="del-btn" onclick="deleteEntry(${idx})">‚ùå</button></div>`;
            total += Number(item.c);
        });
        document.getElementById("liveList").innerHTML = html || "<p style='text-align:center;'>No Entry</p>";
        document.getElementById("liveTotal").innerText = total;
        saveAll();
    }

    function addEntry() {
        let n = document.getElementById("num").value;
        let c = document.getElementById("count").value;
        if (n.length === 3 && c !== "") {
            addManual(n, c);
            document.getElementById("num").value = "";
            document.getElementById("count").value = "";
            document.getElementById("num").focus();
        }
    }

    function boxEntry() {
        let n = document.getElementById("num").value, c = document.getElementById("count").value;
        if (n.length !== 3 || c === "") return;
        let res = new Set();
        let d = n.split('');
        const p = (a, m = []) => { if (a.length === 0) res.add(m.join('')); else a.forEach((v, i) => { let cu = [...a]; cu.splice(i, 1); p(cu, [...m, v]); }); };
        p(d); res.forEach(v => customers[activeIndex].temp.push({n: v, c: Number(c)}));
        beep.play(); renderLive();
    }

    function deleteEntry(idx) { if(confirm("‡¥°‡¥ø‡¥≤‡µÄ‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥£‡µã?")) { customers[activeIndex].temp.splice(idx, 1); renderLive(); } }
    function saveDay() { if (customers[activeIndex].temp.length > 0) { permanent = [...permanent, ...customers[activeIndex].temp]; localStorage.setItem("perm_list", JSON.stringify(permanent)); customers[activeIndex].temp = []; renderLive(); } }
    function resetAll() { if(confirm("Reset All Tabs?")) { customers = [{name: "", temp: []}]; activeIndex = 0; localStorage.removeItem("lottery_customers"); initTabs(); } }

    function openSaved() { document.getElementById("mainPage").classList.add("hidden"); document.getElementById("savedPage").classList.remove("hidden"); renderSaved(false); }
    function backToMain() { document.getElementById("savedPage").classList.add("hidden"); document.getElementById("mainPage").classList.remove("hidden"); }

    function renderSaved(merge) {
        let data = JSON.parse(localStorage.getItem("perm_list")) || [];
        if (merge) {
            let obj = {}; data.forEach(i => obj[i.n] = (obj[i.n] || 0) + Number(i.c));
            data = Object.entries(obj).map(([n, c]) => ({n, c})).sort((a, b) => b.c - a.c);
        }
        let html = "", total = 0;
        data.forEach(item => {
            html += `<div class="item"><span>${item.n} - (<b>${item.c}</b>)</span></div>`;
            total += Number(item.c);
        });
        document.getElementById("savedList").innerHTML = html || "No Data";
        document.getElementById("savedTotal").innerText = total;
    }

    function share(type) {
        let name = document.getElementById("customer").value || "No Name";
        let data = (type === 'live') ? customers[activeIndex].temp : (JSON.parse(localStorage.getItem("perm_list")) || []);
        if (data.length === 0) return;

        if (type === 'saved') {
            let obj = {}; data.forEach(i => obj[i.n] = (obj[i.n] || 0) + Number(i.c));
            data = Object.entries(obj).map(([n, c]) => ({n, c})).sort((a, b) => b.c - a.c);
            let min = prompt("‡¥Æ‡¥ø‡¥®‡¥ø‡¥Æ‡¥Ç ‡¥ï‡µó‡¥£‡µç‡¥ü‡µç?", "0");
            if (min === null) return;
            data = data.filter(i => i.c >= Number(min));
        }

        let txt = `üìù *${name.toUpperCase()}*\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
        let total = 0;
        for (let i = 0; i < data.length; i += 2) {
            let f = data[i], s = data[i+1];
            txt += `*${f.n}*=${f.c}`; total += Number(f.c);
            if (s) { txt += `  |  *${s.n}*=${s.c}`; total += Number(s.c); }
            txt += `\n`;
        }
        txt += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚úÖ *TOTAL : ${total}*`;
        if (type === 'live') saveDay();
        window.location.href = "whatsapp://send?text=" + encodeURIComponent(txt);
    }// ‡¥®‡¥Æ‡µç‡¥™‡µº ‡¥¨‡µã‡¥ï‡µç‡¥∏‡¥ø‡µΩ 3 ‡¥Ö‡¥ï‡µç‡¥ï‡¥Ç ‡¥Ü‡¥Ø‡¥æ‡µΩ ‡¥â‡¥ü‡µª ‡¥ï‡µó‡¥£‡µç‡¥ü‡µç ‡¥¨‡µã‡¥ï‡µç‡¥∏‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥Æ‡¥æ‡¥±‡¥æ‡µª
document.getElementById("num").addEventListener("input", function() {
    if (this.value.length === 3) {
        document.getElementById("count").focus();
    }
});

    initTabs();
</script>
</body>
</html>
